# Component Architecture - Detailed View

## ğŸ—ï¸ **Component Relationships**

This document provides a detailed view of how all components in TokenWatch CLI interact with each other.

## ğŸ“Š **Component Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER INTERFACE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ tokenwatch all  â”‚  â”‚ tokenwatch openaiâ”‚  â”‚ tokenwatch grok â”‚  â”‚ tokenwatch  â”‚ â”‚
â”‚  â”‚ (multi-platform)â”‚  â”‚ (OpenAI only)   â”‚  â”‚ (Grok only)     â”‚  â”‚   setup     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COMMAND LAYER                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   all_cmd.go    â”‚  â”‚  openai_cmd.go  â”‚  â”‚   grok_cmd.go   â”‚  â”‚ setup_cmd.goâ”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ Parallel exec â”‚  â”‚ â€¢ OpenAI logic  â”‚  â”‚ â€¢ Grok logic    â”‚  â”‚ â€¢ Platform  â”‚ â”‚
â”‚  â”‚ â€¢ Aggregation  â”‚  â”‚ â€¢ Period flags  â”‚  â”‚ â€¢ Period flags  â”‚  â”‚   selection â”‚ â”‚
â”‚  â”‚ â€¢ Multi-platformâ”‚  â”‚ â€¢ Data display  â”‚  â”‚ â€¢ Data display  â”‚  â”‚ â€¢ API key   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   input     â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PROVIDER LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  openai.go      â”‚  â”‚   grok.go       â”‚  â”‚  anthropic.go   â”‚  â”‚  cursor.go  â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ OpenAI API    â”‚  â”‚ â€¢ Grok API      â”‚  â”‚ â€¢ Anthropic API â”‚  â”‚ â€¢ Cursor APIâ”‚ â”‚
â”‚  â”‚ â€¢ Usage calls   â”‚  â”‚ â€¢ Usage calls   â”‚  â”‚ â€¢ Usage calls   â”‚  â”‚ â€¢ Usage callsâ”‚ â”‚
â”‚  â”‚ â€¢ Cost calls    â”‚  â”‚ â€¢ Cost calls    â”‚  â”‚ â€¢ Cost calls    â”‚  â”‚ â€¢ Cost calls â”‚ â”‚
â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Rate limit â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                      â”‚                      â”‚                      â”‚ â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â–¼                      â–¼                      â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           PROVIDER INTERFACE                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â”‚ GetPlatform() string                                                   â”‚ â”‚
â”‚  â”‚  â”‚ GetConsumption(start, end time.Time) ([]*Consumption, error)          â”‚ â”‚
â”‚  â”‚  â”‚ GetPricing(start, end time.Time) ([]*Pricing, error)                  â”‚ â”‚
â”‚  â”‚  â”‚ GetConsumptionSummary(period string) (*ConsumptionSummary, error)     â”‚ â”‚
â”‚  â”‚  â”‚ GetPricingSummary(period string) (*PricingSummary, error)             â”‚ â”‚
â”‚  â”‚  â”‚ IsAvailable() bool                                                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MODEL LAYER                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ consumption.go  â”‚  â”‚   pricing.go    â”‚  â”‚   common.go     â”‚  â”‚   types.go  â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ Consumption   â”‚  â”‚ â€¢ Pricing       â”‚  â”‚ â€¢ Common        â”‚  â”‚ â€¢ Platform  â”‚ â”‚
â”‚  â”‚ â€¢ Usage data    â”‚  â”‚ â€¢ Cost data     â”‚  â”‚ â€¢ Time periods  â”‚  â”‚   constants â”‚ â”‚
â”‚  â”‚ â€¢ Token counts  â”‚  â”‚ â€¢ Model rates   â”‚  â”‚ â€¢ Period calc   â”‚  â”‚ â€¢ API URLs  â”‚ â”‚
â”‚  â”‚ â€¢ Request info  â”‚  â”‚ â€¢ Total costs   â”‚  â”‚ â€¢ Date utils    â”‚  â”‚ â€¢ Endpoints â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CONFIG LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   config.go     â”‚  â”‚  viper.yaml     â”‚  â”‚  env_vars       â”‚  â”‚  defaults   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ Config init   â”‚  â”‚ â€¢ User settings â”‚  â”‚ â€¢ API keys      â”‚  â”‚ â€¢ Cache     â”‚ â”‚
â”‚  â”‚ â€¢ File loading  â”‚  â”‚ â€¢ Display opts  â”‚  â”‚ â€¢ Timeouts      â”‚  â”‚ â€¢ Timeouts  â”‚ â”‚
â”‚  â”‚ â€¢ API key mgmt  â”‚  â”‚ â€¢ Output format â”‚  â”‚ â€¢ Debug flags   â”‚  â”‚ â€¢ Retries   â”‚ â”‚
â”‚  â”‚ â€¢ Validation    â”‚  â”‚ â€¢ Color themes  â”‚  â”‚ â€¢ Log levels    â”‚  â”‚ â€¢ Formats   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              EXTERNAL APIs                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OpenAI API      â”‚  â”‚ Grok API        â”‚  â”‚ Anthropic API   â”‚  â”‚ Cursor API  â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ Usage         â”‚  â”‚ â€¢ Usage         â”‚  â”‚ â€¢ Usage         â”‚  â”‚ â€¢ Usage     â”‚ â”‚
â”‚  â”‚ â€¢ Costs         â”‚  â”‚ â€¢ Costs         â”‚  â”‚ â€¢ Costs         â”‚  â”‚ â€¢ Costs     â”‚ â”‚
â”‚  â”‚ â€¢ Models        â”‚  â”‚ â€¢ Models        â”‚  â”‚ â€¢ Models        â”‚  â”‚ â€¢ Models    â”‚ â”‚
â”‚  â”‚ â€¢ Rate limits   â”‚  â”‚ â€¢ Rate limits   â”‚  â”‚ â€¢ Rate limits   â”‚  â”‚ â€¢ Rate limitâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— **Component Dependencies**

### **Command Layer Dependencies**
```
all_cmd.go
â”œâ”€â”€ internal/config (for API keys)
â”œâ”€â”€ pkg/providers (for platform providers)
â”œâ”€â”€ pkg/models (for data structures)
â””â”€â”€ sync (for parallel execution)

openai_cmd.go
â”œâ”€â”€ internal/config (for API keys)
â”œâ”€â”€ pkg/providers/openai (for OpenAI provider)
â””â”€â”€ pkg/models (for data structures)

grok_cmd.go
â”œâ”€â”€ internal/config (for API keys)
â”œâ”€â”€ pkg/providers/grok (for Grok provider)
â””â”€â”€ pkg/models (for data structures)
```

### **Provider Layer Dependencies**
```
openai.go
â”œâ”€â”€ pkg/models (for data structures)
â”œâ”€â”€ net/http (for API calls)
â”œâ”€â”€ encoding/json (for JSON parsing)
â””â”€â”€ time (for time handling)

grok.go
â”œâ”€â”€ pkg/models (for data structures)
â”œâ”€â”€ net/http (for API calls)
â”œâ”€â”€ encoding/json (for JSON parsing)
â””â”€â”€ time (for time handling)
```

### **Model Layer Dependencies**
```
consumption.go
â”œâ”€â”€ time (for time handling)
â””â”€â”€ encoding/json (for JSON tags)

pricing.go
â”œâ”€â”€ time (for time handling)
â””â”€â”€ encoding/json (for JSON tags)
```

## ğŸ”„ **Data Flow Between Components**

### **1. Single Platform Command Flow**
```
User â†’ openai_cmd.go â†’ openai.go â†’ OpenAI API â†’ openai.go â†’ openai_cmd.go â†’ User
```

### **2. Multi-Platform Command Flow**
```
User â†’ all_cmd.go â†’ [openai.go, grok.go, anthropic.go] â†’ [APIs] â†’ [providers] â†’ all_cmd.go â†’ User
```

### **3. Configuration Flow**
```
User â†’ setup_cmd.go â†’ config.go â†’ config.yaml â†’ config.go â†’ providers
```

## ğŸ“‹ **Interface Contracts**

### **Provider Interface**
```go
type Provider interface {
    GetPlatform() string
    GetConsumption(startTime, endTime time.Time) ([]*models.Consumption, error)
    GetPricing(startTime, endTime time.Time) ([]*models.Pricing, error)
    GetConsumptionSummary(period string) (*models.ConsumptionSummary, error)
    GetPricingSummary(period string) (*models.PricingSummary, error)
    IsAvailable() bool
}
```

### **Data Model Contracts**
```go
type ConsumptionSummary struct {
    Platform      string
    Model         string
    TotalTokens   int64
    TotalRequests int64
    StartTime     time.Time
    EndTime       time.Time
}

type PricingSummary struct {
    Platform   string
    Model      string
    TotalCost  float64
    StartTime  time.Time
    EndTime    time.Time
}
```

## ğŸ¯ **Key Design Patterns**

### **1. Strategy Pattern**
- **Each platform implements the same Provider interface**
- **Commands can work with any provider without knowing implementation details**
- **Easy to swap or add new platform implementations**

### **2. Factory Pattern**
- **`getProvider()` function creates appropriate provider instances**
- **Centralized provider creation logic**
- **Easy to add new platform types**

### **3. Observer Pattern**
- **Parallel execution with result collection via channels**
- **Non-blocking API calls with result aggregation**
- **Graceful handling of platform failures**

### **4. Template Method Pattern**
- **Common command structure across all platforms**
- **Platform-specific logic isolated in provider implementations**
- **Consistent user experience across all commands**

## ğŸ”’ **Encapsulation & Boundaries**

### **Command Layer**
- **Public**: Command definitions and help text
- **Private**: Internal command logic and data processing
- **Boundary**: User input validation and output formatting

### **Provider Layer**
- **Public**: Provider interface implementation
- **Private**: API call logic, authentication, rate limiting
- **Boundary**: Data transformation between API format and common models

### **Model Layer**
- **Public**: Data structures and validation methods
- **Private**: Internal data processing logic
- **Boundary**: Data serialization/deserialization

### **Config Layer**
- **Public**: Configuration access methods
- **Private**: File I/O, validation, defaults
- **Boundary**: Configuration file format and environment variables

## ğŸš€ **Extension Points**

### **Adding New Platforms**
1. **Create new provider file**: `pkg/providers/{platform}.go`
2. **Implement Provider interface**: All required methods
3. **Create command file**: `cmd/root/{platform}_cmd.go`
4. **Update provider factory**: Add to `getProvider()` function
5. **Update setup command**: Add to supported platforms list

### **Adding New Commands**
1. **Create command file**: `cmd/root/{command}_cmd.go`
2. **Define command structure**: Use cobra.Command
3. **Implement command logic**: Use existing providers and models
4. **Add to root command**: Update main.go

### **Adding New Data Models**
1. **Create model file**: `pkg/models/{model}.go`
2. **Define data structure**: Use Go structs with JSON tags
3. **Add validation**: Implement validation methods
4. **Update providers**: Use new models in provider implementations

---

**This component architecture ensures clean separation, easy maintenance, and simple extension while maintaining consistent interfaces and data flow throughout the system.**
